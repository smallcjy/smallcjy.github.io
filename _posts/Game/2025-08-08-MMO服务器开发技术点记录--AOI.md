---
title: AOI--MMO服务器开发技术点记录
date: 2025-08-10 16:30:31
tags: [游戏后台]
---

对于AOI的详细原理，可以具体参考我这篇博客：[AOI](https://smallcjy.github.io/posts/AOI/); 本篇文章我们的重心是放在如何将一个基本的AOI系统实现进我们的MMO服务器。

可以把一个AOI系统当作一个运行在服务器中的虚拟的场景，玩家实体在其中表现为一个AOI实体。AOI实体的结构如下：
```cpp
struct AOIEntity
{
    uint32_t id;
    Vector3 position;
    Vector3 direction;

    vector<int> interests; // 关注的实体列表 我关注谁
    vector<int> observers;  // 观察者列表 谁在关注我
};

同时还需要一个订阅通知结构来通知实体进入和离开场景
```cpp
struct AOINotification
{
    enum class Type
    {
        Enter,
        Leave
    };

    Type type;
    AOIEntity entity;
};

struct AOIEntity
{
    vector<AOINotification> notifications; // 订阅通知列表
};
```

AOI实体中有些数据是在同步时我们不需要的，可以单独抽象出一个AOI状态，表示当前实体的AOI状态：
```cpp
struct AoiState {
    int eid;

    std::vector<int> interests;
    std::vector<AoiNotification> notifies;

    AOIState(AOIEntity& entity) : eid(entity.eid), interests(entity.interests.begin(), entity.interests.end()) {
        notifies.swap(entity.notifications);
    }
};

