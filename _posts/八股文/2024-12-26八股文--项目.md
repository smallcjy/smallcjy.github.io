---
title: 八股文-项目
date: 2024-12-25 20:51:07
tags: [dragonos, ncx, modernlibre]
---

# DragonOS
## syscall alarm
q1：什么是syscall alarm？

alarm系统调用是我加入dragonos社区领到的第一个任务，算是个新手任务。负责实现alarm系统调用。alarm系统调用的作用就是内核申请一个定时器alarm，在经过一段时间后向用户程序发送一个SYSALATM信号，用户程序捕捉到这个信号后执行提前设定号的回调函数。

这个alarm结构体注册在用户进程的PCB中，一个用户进程就只有一个alarm（在dragonos里目前的实现是这个样子的。alarm结构体的设计是这样子的，alarm由定时器和定时器触发时间组成。定时器由触发时间戳和回调函数组成。回调函数的作用是向目标进程发送alarm信号。

设定好定时器，然后激活定时器，把定时器插入到定时器链表里，链表按照定时器触发时间的先后排序。这里简单说下系统定时器的原理。就是向中断向量注册中断号timer和中断处理程序。中断处理为找定时器链表中过时的定时器，运行他们的回调函数。

下面再讲一下信号机制。TODO
## Loopback 

Loopback网卡和网卡驱动的编写是我在dragonos社区内接到的第二个任务，这个任务相比较于上一个任务有一些难度。首先在我开始设计前，我需要了解dragonos现有的设备驱动模型。

可以围绕几个trait来给面试官介绍，正好也可以体现一下rust的先进性。

dragonos的设备驱动模型是这样的，首先由设备Device trait和驱动Driver trait构成基本元素，rust的特征trait可以定义共享行为，将所有设备和驱动都需要使用的具有相似性的函数设置成trait 接口里，所有的设备和驱动都需要去自定义这些函数。就类似于adapt适配器设计模式。Device接口负责提供一些基本的设备信息就拿我写的loopback网卡来说，向设备类型，设备名，设备驱动等等。Driver接口负责将设备加入到驱动中，额由于Lo设备是单设备和单驱动，所以就不需要为驱动实现这个接口。然后在自己的设备和驱动的实现中需要自定义上述接口。

然后作为网络设备，也有一些抽象出来的接口需要去实现。dragonos内的网络设备模型需要你实现两个接口，一个网卡设备接口和网络协议栈接口。网卡设备接口的作用首先是获取网卡基本信息和网卡状态，像网卡名，mac地址，然后每个网卡都需要有poll函数，供中断到来时，内核去使用网卡。网卡的poll函数本质上是一个中断处理函数。然后就是网络协议层接口，由于网络协议栈是非常复杂的，为了实现短期上线网络功能，dragonos内部现在是使用一个叫smoltcp的开源的网络协议栈，像阿里的星链操作系统也同样是使用那个协议栈。为了减小协议栈和网络设备的耦合，smoltcp定义了需要网卡实现的接口函数，也是为driver实现的trait，主要包括网卡的收发包函数。这里的接收的数据包和发送的数据包需要网卡根据接收的数据去创建，需要去定义它们的消费函数。

介绍完模型后，就到了重点的地方，实现lo设备及其驱动。lo设备叫本地环回设备，向lo设备发送的数据包从传输层下来到网络层，发送到lo设备的缓冲区。lo的缓冲区实现为一个队列，发送的数据包从队尾进入，从队头获取接收到的数据包。这样就能实现发包即收包，实现本地环回。同时还为队列设置一个capacity，模拟丢包。

lo设备的驱动就是自定义网络协议栈需要实现的接口函数，就是设备的收发包函数。就是创建数据包，返回给网络栈消费。

lo发包的时候就直接写到缓冲队列，然后用户调用recv函数去收包。以上就是我实现lo网卡的全部过程

## Unix socket

unix socket 是一种进程间的通信方式。和传统的inet socket不同，unix socket的特点是共用一套POXIC接口协议，支持datagram、stream、seqpacket协议。datagram协议类似与udp协议、stream协议类似于stream协议、seqpacket在面向连接的基础性上保证了包的次序是按顺序。seqpacket在实现上和stream一致，但是结合了datagram的消息边界的特性。但是由于现在dragonos还没有支持datagram，相关设施没有搭建，所以seqpacket的实现和stream保持一致。

可以和面试官聊一聊端点唯一性的问题。unix的端点类型有两种，一种是文件，一种是抽象地址。现在dragonos的实现是维护一张hash表，使用文件的inodeid作为索引找到socket inode

# NCX
## Linux Server Structure
## NAT concept
## CPP Modern Usage
## ZeroMQ

# MODERNLIBRE
## actix-web
## oss server / minio
## mirco services