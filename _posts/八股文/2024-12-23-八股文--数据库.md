---
title: 数据库八股文
date: 2024-05-27 10:48:31
tags: [数据库]
---

# Mysql
- mysql 有几种存储引擎？
- innoDB 是怎么存储一个行数据的？
- innoDB 索引的类型事务的隔离级别
- MVCC 是什么？

# Redis

## Redis中的key值非常大会造成什么影响？
1. 对持久化的影响（AOF、RDB）：
当 AOF 写回策略配置了 Always 策略，如果写入是一个大 Key，主线程在执行 fsync() 函数的时候，阻塞的时间会比较久，因为当写入的数据量很大的时候，数据同步到硬盘这个过程是很耗时的。
 
AOF 重写机制和 RDB 快照（bgsave 命令）的过程，都会分别通过 fork() 函数创建一个子进程来处理任务。会有两个阶段会导致阻塞父进程（主线程）： 
- 创建子进程的途中，由于要复制父进程的页表等数据结构，阻塞的时间跟页表的大小有关，页表越大，阻塞的时间也越长； 
- 创建完子进程后，如果父进程修改了共享数据中的大 Key，就会发生写时复制，这期间会拷贝物理内存，由于大 Key 占用的物理内存会很大，那么在复制物理内存这一过程，就会比较耗时，所以有可能会阻塞父进程。

2. 其他影响：

- 客户端超时阻塞。由于 Redis 执行命令是单线程处理，然后在操作大 key 时会比较耗时，那么就会阻塞 Redis，从客户端这一视角看，就是很久很久都没有响应。 
- 引发网络阻塞。每次获取大 key 产生的网络流量较大，如果一个 key 的大小是 1 MB，每秒访问量为 1000，那么每秒会产生 1000MB 的流量，这对于普通千兆网卡的服务器来说是灾难性的。 
- 阻塞工作线程。如果使用 del 删除大 key 时，会阻塞工作线程，这样就没办法处理后续的命令。 
- 内存分布不均。集群模型在 slot 分片均匀情况下，会出现数据和查询倾斜情况，部分有大 key 的 Redis 节点占用内存多。

## 如何解决Redis中key值非常大的问题？

- 在设计阶段把key值设计成小key值
- 定时检查 Redis 是否存在大 key ，如果该大 key 是可以删除的，不要使用 DEL 命令删除，因为该命令删除过程会阻塞主线程，而是用 unlink 命令（Redis 4.0+）删除大 key，因为该命令的删除过程是异步的，不会阻塞主线程。

## Redis高可用策略
### 主从复制
### 哨兵模式
### 切片集群

## Redis脑裂

由于网络问题，集群节点之间失去联系。主从数据不同步；重新平衡选举，产生两个主服务。等网络恢复，旧主节点会降级为从节点，再与新主节点进行同步复制的时候，由于会从节点会清空自己的缓冲区，所以导致之前客户端写入的数据丢失了。

## Redis 过期删除

![alt text](assets/img/2024-12-23-八股文--数据库/image.png)

![alt text](assets/img/2024-12-23-八股文--数据库/image-1.png)

### Redis内存满了会怎么处理？

![alt text](assets/img/2024-12-23-八股文--数据库/image-2.png)

## Redis 缓存
### 缓存雪崩&&缓存击穿

![alt text](assets/img/2024-12-23-八股文--数据库/image-3.png)


### 缓存穿透

![alt text](assets/img/2024-12-23-八股文--数据库/image-4.png)

## 常见的缓存更新策略

### cache aside

![alt text](assets/img/2024-12-23-八股文--数据库/image-5.png)

### read/write through && write back

![alt text](assets/img/2024-12-23-八股文--数据库/image-6.png)

